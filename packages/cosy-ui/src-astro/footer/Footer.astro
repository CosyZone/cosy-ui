---
/**
 * @component Footer
 *
 * @description
 * Footer 组件用于创建网站的页脚部分，提供版权信息、导航链接和社交媒体链接等内容。
 * 该组件支持高度自定义，可以根据需要显示或隐藏不同的部分。
 *
 * @design
 * 设计理念：
 * 1. 清晰的信息层次 - 通过视觉层次和分组展示不同类别的页脚信息
 * 2. 响应式布局 - 在不同屏幕尺寸下保持良好的可用性和美观性
 * 3. 可定制性 - 支持多种配置选项，适应不同网站的需求
 * 4. 品牌一致性 - 与网站整体设计风格保持一致
 * 5. 多语言支持 - 支持多种语言显示，自动检测当前语言环境
 *
 * 视觉特点：
 * - 分区布局：清晰区分不同类别的信息
 * - 简洁设计：使用适当的间距和字体大小确保可读性
 * - 品牌展示：突出显示网站名称和标语
 * - 社交媒体整合：提供社交媒体链接的展示
 *
 * @usage
 * 基本用法：
 * ```astro
 * <Footer
 *   siteName="我的网站"
 *   homeLink="/"
 *   slogan="简单而强大"
 *   company="我的公司"
 *   copyright="保留所有权利"
 *   inspirationalSlogan="构建美好的数字体验"
 * />
 * ```
 *
 * 添加社交媒体链接：
 * ```astro
 * <Footer
 *   siteName="我的网站"
 *   homeLink="/"
 *   slogan="简单而强大"
 *   company="我的公司"
 *   copyright="保留所有权利"
 *   inspirationalSlogan="构建美好的数字体验"
 *   socialLinks={[
 *     "https://github.com/myusername",
 *     "https://twitter.com/myusername"
 *   ]}
 * />
 * ```
 *
 * 添加产品链接：
 * ```astro
 * <Footer
 *   siteName="我的网站"
 *   homeLink="/"
 *   slogan="简单而强大"
 *   company="我的公司"
 *   copyright="保留所有权利"
 *   inspirationalSlogan="构建美好的数字体验"
 *   products={[
 *     { name: "产品A", href: "/products/a" },
 *     { name: "产品B", href: "/products/b" }
 *   ]}
 * />
 * ```
 *
 * 添加友情链接：
 * ```astro
 * <Footer
 *   siteName="我的网站"
 *   homeLink="/"
 *   slogan="简单而强大"
 *   company="我的公司"
 *   copyright="保留所有权利"
 *   inspirationalSlogan="构建美好的数字体验"
 *   friendlyLinks={[
 *     { name: "合作伙伴A", href: "https://partner-a.com" },
 *     { name: "合作伙伴B", href: "https://partner-b.com", external: true }
 *   ]}
 * />
 * ```
 *
 * 完整示例：
 * ```astro
 * <Footer
 *   siteName="我的网站"
 *   homeLink="/"
 *   slogan="简单而强大"
 *   company="我的公司"
 *   copyright="保留所有权利"
 *   inspirationalSlogan="构建美好的数字体验"
 *   logo={{ src: "/logo.png", alt: "网站Logo" }}
 *   products={[
 *     { name: "产品A", href: "/products/a" },
 *     { name: "产品B", href: "/products/b" }
 *   ]}
 *   friendlyLinks={[
 *     { name: "合作伙伴A", href: "https://partner-a.com" },
 *     { name: "合作伙伴B", href: "https://partner-b.com", external: true }
 *   ]}
 *   socialLinks={[
 *     "https://github.com/myusername",
 *     "https://twitter.com/myusername"
 *   ]}
 *   aboutLink="/about"
 *   contactLink="/contact"
 *   termsLink="/terms"
 *   privacyLink="/privacy"
 * />
 * ```
 *
 * 指定语言：
 * ```astro
 * <Footer
 *   siteName="My Website"
 *   homeLink="/"
 *   slogan="Simple and Powerful"
 *   company="My Company"
 *   copyright="All Rights Reserved"
 *   lang="en"
 * />
 * ```
 *
 * 启用日志：
 * ```astro
 * <Footer
 *   siteName="我的网站"
 *   homeLink="/"
 *   enableLogging={true}
 * />
 * ```
 *
 * @props
 * @prop {string} siteName - 网站名称
 * @prop {string} homeLink - 首页链接
 * @prop {string} slogan - 网站标语
 * @prop {string} company - 公司名称
 * @prop {string} copyright - 版权信息
 * @prop {string} inspirationalSlogan - 鼓舞人心的标语，显示在横幅中
 * @prop {string} [icp] - ICP备案号（中国网站需要）
 * @prop {Object} [logo] - 网站Logo对象，包含src和alt属性
 * @prop {Array<Object>} [products=[]] - 产品链接数组，每个对象包含name、href和可选的external属性
 * @prop {Array<Object>} [friendlyLinks=[]] - 友情链接数组，每个对象包含name、href和可选的external属性
 * @prop {string} [aboutLink] - "关于我们"页面链接
 * @prop {string} [contactLink] - "联系我们"页面链接
 * @prop {string} [termsLink] - "服务条款"页面链接
 * @prop {string} [privacyLink] - "隐私政策"页面链接
 * @prop {Array<string>} [socialLinks=[]] - 社交媒体链接数组
 * @prop {string} [teamLink] - "团队介绍"页面链接
 * @prop {string} [careersLink] - "加入我们"页面链接
 * @prop {string} [newsLink] - "新闻动态"页面链接
 * @prop {string} [historyLink] - "发展历程"页面链接
 * @prop {string} [partnersLink] - "合作伙伴"页面链接
 * @prop {string} [blogLink] - "技术博客"页面链接
 * @prop {string} [faqLink] - "常见问题"页面链接
 * @prop {string} [mediaLink] - "媒体报道"页面链接
 * @prop {string} [techStackLink] - "技术栈"页面链接
 * @prop {boolean} [debug=false] - 调试模式
 * @prop {string} [lang] - 语言代码，默认自动检测
 * @prop {boolean} [enableLogging=false] - 是否启用日志输出
 *
 * @accessibility
 * - 使用语义化HTML结构，确保屏幕阅读器可以正确解析
 * - 所有链接都有明确的文本描述
 * - 社交媒体图标包含屏幕阅读器专用的文本说明
 */

import { processSocialLink } from '../../src/utils/social.ts';
import {
  SocialIcon,
  LanguageUtil,
  type IFooterProps,
  createTextGetter,
  Link,
} from '../../index-astro';
import FooterSection from './FooterSection.astro';
import '../../style.ts';
import FooterCopyright from './FooterCopyright.astro';

const {
  siteName,
  homeLink,
  slogan,
  company,
  copyright,
  inspirationalSlogan,
  icp,
  logo,
  products = [],
  friendlyLinks = [],
  aboutLink,
  contactLink,
  termsLink,
  privacyLink,
  socialLinks = [],
  teamLink,
  careersLink,
  newsLink,
  historyLink,
  partnersLink,
  blogLink,
  faqLink,
  mediaLink,
  techStackLink,
  debug = false,
} = Astro.props as IFooterProps;

// 获取当前语言
const lang = LanguageUtil.getCurrentLanguage(Astro);
// 创建文本获取函数
const t = createTextGetter(lang, 'footer');

const currentYear = new Date().getFullYear();

// 处理社交链接
const processedSocialLinks = socialLinks.map((url) => processSocialLink(url));

// 调试模式的样式类
const debugClasses = debug
  ? {
      footer: 'cosy:border-2 cosy:border-blue-500',
      section: 'cosy:border-2 cosy:border-green-500',
      nav: 'cosy:border-2 cosy:border-yellow-500',
      aside: 'cosy:border-2 cosy:border-purple-500',
    }
  : {
      footer: '',
      section: '',
      nav: '',
      aside: '',
    };
---

<footer
  class:list={[
    'cosy:footer cosy:z-50 cosy:sm:footer-horizontal cosy:bg-base-200 cosy:text-base-content cosy:p-10',
    debugClasses.footer,
  ]}>
  <div
    class:list={[
      'cosy:flex cosy:flex-col cosy:md:h-56 cosy:gap-8 cosy:container cosy:mx-auto cosy:items-center cosy:w-full cosy:md:flex-row cosy:md:justify-between',
      debugClasses.section,
    ]}>
    {/* 品牌区域 */}
    <aside class:list={['cosy:max-w-xs cosy:text-center', debugClasses.aside]}>
      <Link href={homeLink} align="center" noUnderline block class="cosy:mb-4">
        {
          logo && (
            <img
              src={logo.src}
              alt={logo.alt}
              class="cosy:w-12 cosy:h-12 cosy:mask cosy:mask-squircle"
              width="48"
              height="48"
            />
          )
        }
        <div>
          <h2 class="cosy:font-bold cosy:text-xl">{siteName}</h2>
          <p class="cosy:text-base-content/70">{slogan}</p>
        </div>
      </Link>

      {/* 社交媒体链接 */}
      {
        processedSocialLinks.length > 0 && (
          <div class="cosy:flex cosy:justify-center cosy:gap-2 cosy:mt-4">
            {processedSocialLinks.map((link) => (
              <Link
                href={link.url}
                btn
                circle
                ghost
                size="sm"
                color="primary"
                external
                rel="noopener noreferrer"
                aria-label={link.name}>
                <SocialIcon platform={link.platform} />
              </Link>
            ))}
          </div>
        )
      }
    </aside>

    {/* 导航区域 */}
    <div
      class:list={[
        'cosy:flex cosy:h-full cosy:flex-col cosy:justify-center cosy:gap-8 cosy:mx-auto cosy:max-w-xl cosy:text-center cosy:items-center cosy:w-full cosy:md:flex-row cosy:md:justify-between cosy:md:items-start',
        debugClasses.section,
      ]}>
      {/* 产品导航 */}
      {
        products.length > 0 && (
          <FooterSection title={t('products')} links={products} />
        )
      }

      {/* 友情链接导航 */}
      {
        friendlyLinks.length > 0 && (
          <FooterSection title={t('friendlyLinks')} links={friendlyLinks} />
        )
      }

      {/* 关于导航 */}
      {
        (aboutLink || contactLink || teamLink || careersLink) && (
          <FooterSection
            title={t('about')}
            links={[
              { name: t('aboutUs'), href: aboutLink ?? '' },
              { name: t('team'), href: teamLink ?? '' },
              { name: t('careers'), href: careersLink ?? '' },
              { name: t('contactUs'), href: contactLink ?? '' },
            ].filter((link) => link.href)}
          />
        )
      }

      {/* 资源导航 */}
      {
        (newsLink ||
          historyLink ||
          partnersLink ||
          blogLink ||
          faqLink ||
          mediaLink ||
          techStackLink) && (
          <FooterSection
            title={t('resources')}
            links={[
              { name: t('news'), href: newsLink ?? '' },
              { name: t('blog'), href: blogLink ?? '' },
              { name: t('faq'), href: faqLink ?? '' },
              { name: t('history'), href: historyLink ?? '' },
              { name: t('techStack'), href: techStackLink ?? '' },
            ].filter((link) => link.href)}
          />
        )
      }

      {/* 法律导航 */}
      {
        (termsLink || privacyLink) && (
          <FooterSection
            title={t('legal')}
            links={[
              { name: t('terms'), href: termsLink ?? '' },
              { name: t('privacy'), href: privacyLink ?? '' },
            ].filter((link) => link.href)}
          />
        )
      }
    </div>
  </div>
</footer>

{/* 横幅 */}
{
  inspirationalSlogan && (
    <aside class:list={['cosy:p-4 cosy:w-full', debugClasses.aside]}>
      <p class="cosy:text-center">{inspirationalSlogan}</p>
    </aside>
  )
}

{/* 底部版权信息 */}
<FooterCopyright
  company={company}
  copyright={copyright}
  icp={icp}
  currentYear={currentYear}
  t={t}
  debugClasses={debugClasses}
/>
