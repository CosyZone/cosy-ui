---
/**
 * @component Toast
 *
 * @description
 * Toast 组件用于显示临时的通知消息，支持多种类型和自动消失功能。
 * 通常不直接使用，而是通过全局的 toast 系统来显示。
 * 
 * @usage
 * 通过全局函数使用：
 * ```javascript
 * // 基本用法
 * showToast('操作成功完成！');
 *
 * // 带类型的用法
 * showToast({
 *   message: '保存成功！',
 *   type: 'success',
 *   duration: 2000
 * });
 *
 * // 错误提示
 * showToast({
 *   message: '网络连接失败，请重试',
 *   type: 'error',
 *   duration: 5000
 * });
 *
 * // 关闭特定 toast
 * const toastId = showToast('正在处理...');
 * setTimeout(() => closeToast(toastId), 1000);
 *
 * // 清除所有 toast
 * clearAllToasts();
 * ```
 *
 * @props
 * - message: string - 显示的消息内容
 * - type: ToastType - 消息类型，影响样式和图标 ('info' | 'success' | 'warning' | 'error')
 * - id: string - 唯一标识符
 */

import {
    CloseIcon,
    ErrorIcon,
    InfoIcon,
    SuccessIcon,
    WarningIcon,
} from '../../index-astro';
import { cn } from '../../src/class';
import type { ToastType } from './types';
import { getToastStyle } from './types';

export interface Props {
    /**
     * 显示的消息内容
     */
    message: string;

    /**
     * 消息类型，影响样式和图标
     */
    type: ToastType;

    /**
     * 唯一标识符
     */
    id: string;
}

const { message, type, id } = Astro.props;

const style = getToastStyle(type);

// 根据类型选择图标
const IconComponent = {
    info: InfoIcon,
    success: SuccessIcon,
    warning: WarningIcon,
    error: ErrorIcon,
}[type];

// 使用 classBuilder 构建 toast 类名
const toastClass = cn()
    .add('cosy:alert') // 保留：DaisyUI 组件类名
    .shadow('lg')
    .flex()
    .items('center')
    .gap(3)
    .pr(2)
    .transform()
    .transitionAll()
    .duration(300)
    .easeInOut()
    .translateX('full')
    .opacity0()
    .add('toast-enter:cosy:translate-x-0', 'toast-enter:cosy:opacity-100') // 保留：伪类状态
    .add('toast-exit:cosy:translate-x-full', 'toast-exit:cosy:opacity-0') // 保留：伪类状态
    .add(style.bg, style.border) // 保留：动态样式
    .build();
---

<div class={toastClass} data-toast-id={id} role="alert" aria-live="polite">
    <IconComponent size="20px" />
    <span class="cosy:flex-1 cosy:text-sm cosy:font-medium">{message}</span>
    <button
        class="cosy:btn cosy:btn-ghost cosy:btn-xs cosy:btn-circle cosy:opacity-70 hover:cosy:opacity-100"
        onclick={`window.closeToast?.('${id}')`}
        aria-label="关闭通知"
        type="button">
        <CloseIcon size="16px" />
    </button>
</div>
