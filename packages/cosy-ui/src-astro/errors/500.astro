---
/**
 * @component Error500
 *
 * @description
 * 500服务器内部错误页面组件，用于显示服务器出现内部错误的提示信息。
 * 提供友好的错误说明和帮助用户解决问题的操作建议。
 *
 * @usage
 * 基本用法：
 * ```astro
 * <Error500 />
 * ```
 *
 * 带错误信息：
 * ```astro
 * <Error500 debugKVs={{
 *   errorId: 'ERR_2024_001',
 *   timestamp: new Date().toISOString(),
 *   serverInfo: 'Server-01'
 * }} />
 * ```
 *
 * @props
 * @prop {Record<string, string>} [debugKVs={}] - 调试信息键值对，用于开发和调试
 * @prop {string} [supportUrl] - 技术支持页面URL
 * @prop {string} [statusPageUrl] - 系统状态页面URL
 */

import { cn } from '../../src/class';
import { ErrorPageFacade } from '../../src/components/errors';
import { LinkUtil } from '../../src/utils/link';

const baseUrl = LinkUtil.getBaseUrl();
const path = Astro.url.pathname;

interface Error500Props {
    debugKVs?: Record<string, string>;
    supportUrl?: string;
    statusPageUrl?: string;
}

const {
    debugKVs = {},
    supportUrl,
    statusPageUrl,
} = Astro.props as Error500Props;

// 使用共用代码获取类名
const classes = ErrorPageFacade.getError500Classes({ debugKVs, supportUrl, statusPageUrl });
---

<div class={classes.container}>
    <div class={classes.content}>
        <!-- 错误代码 -->
        <div class={classes.errorCodeContainer}>
            <h1 class={classes.errorCodeTitle}>
                500
            </h1>
            <div class={classes.errorCodeLine}>
            </div>
        </div>

        <!-- 错误信息 -->
        <div class={classes.errorMessageContainer}>
            <h2 class={classes.errorMessageTitle}>
                服务器内部错误
            </h2>
            <p class={classes.errorMessageText}>
                服务器遇到了一个内部错误，无法完成您的请求。
            </p>
        </div>

        <!-- 路径信息 -->
        <div class={classes.pathInfo}>
            <p>
                <span class={cn().weight('medium').build()}>路径：</span><code
                    class={cn().color('error').build()}>{path}</code
                >
            </p>
        </div>

        <!-- 调试信息 -->
        {
            Object.keys(debugKVs).length > 0 && (
                <details class={classes.debugInfo}>
                    <summary class={classes.debugInfoSummary}>
                        错误信息
                    </summary>
                    <div class={classes.debugInfoContent}>
                        {Object.entries(debugKVs).map(([key, value]) => (
                            <div class={classes.debugInfoItem}>
                                <span class={classes.debugInfoKey}>
                                    {key}:
                                </span>
                                <span class={classes.debugInfoValue}>
                                    {value}
                                </span>
                            </div>
                        ))}
                    </div>
                </details>
            )
        }

        <!-- 建议信息 -->
        <div class={classes.suggestion}>
            <h3 class={classes.suggestionTitle}>
                您可以尝试：
            </h3>
            <ul class={classes.suggestionList}>
                <li>• 刷新页面</li>
                <li>• 几分钟后重试</li>
                <li>• 检查您的网络连接</li>
                <li>• 联系技术支持</li>
            </ul>
        </div>

        <!-- 操作按钮 -->
        <div class={classes.actions}>
            <button
                onclick="window.location.reload()"
                class={cn().add('cosy:btn cosy:btn-primary').w('full').build()}
                type="button">
                刷新页面
            </button>

            <a
                href={baseUrl}
                class={cn().add('cosy:btn cosy:btn-outline cosy:no-underline').w('full').build()}>
                返回首页
            </a>

            {
                statusPageUrl && (
                    <a
                        href={statusPageUrl}
                        class={cn().add('cosy:btn cosy:btn-ghost cosy:no-underline').w('full').build()}>
                        查看系统状态
                    </a>
                )
            }

            {
                supportUrl && (
                    <a
                        href={supportUrl}
                        class={cn().add('cosy:btn cosy:btn-ghost cosy:no-underline').w('full').build()}>
                        联系技术支持
                    </a>
                )
            }
        </div>

        <!-- 帮助提示 -->
        <div class={classes.helpText}>
            <p>如果问题持续存在，请联系我们的技术支持团队</p>
        </div>
    </div>
</div>
