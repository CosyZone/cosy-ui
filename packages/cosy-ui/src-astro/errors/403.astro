---
/**
 * @component Error403
 *
 * @description
 * 403禁止访问错误页面组件，用于显示用户无权限访问页面的提示信息。
 * 提供清晰的权限说明和相关的操作建议。
 *
 * @usage
 * 基本用法：
 * ```astro
 * <Error403 />
 * ```
 *
 * 带调试信息：
 * ```astro
 * <Error403 debugKVs={{
 *   requiredRole: 'admin',
 *   currentRole: 'user',
 *   resource: '/admin/dashboard'
 * }} />
 * ```
 *
 * @props
 * @prop {Record<string, string>} [debugKVs={}] - 调试信息键值对，用于开发和调试
 * @prop {string} [loginUrl] - 登录页面URL，如果提供将显示登录按钮
 * @prop {string} [contactUrl] - 联系我们页面URL，如果提供将显示联系按钮
 */

import { cn } from '../../src/class';
import { ErrorPageFacade } from '../../src/components/errors';
import { LinkUtil } from '../../src/utils/link';

const baseUrl = LinkUtil.getBaseUrl();
const path = Astro.url.pathname;

interface Error403Props {
    debugKVs?: Record<string, string>;
    loginUrl?: string;
    contactUrl?: string;
}

const { debugKVs = {}, loginUrl, contactUrl } = Astro.props as Error403Props;

// 使用共用代码获取类名
const classes = ErrorPageFacade.getError403Classes({ debugKVs, loginUrl, contactUrl });
---

<div class={classes.container}>
    <div class={classes.content}>
        <!-- 错误代码 -->
        <div class={classes.errorCodeContainer}>
            <h1 class={cn().add(classes.errorCodeTitle).add('cosy:no-underline').build()}>
                403
            </h1>
            <div class={classes.errorCodeLine}>
            </div>
        </div>

        <!-- 错误信息 -->
        <div class={classes.errorMessageContainer}>
            <h2 class={classes.errorMessageTitle}>
                禁止访问
            </h2>
            <p class={classes.errorMessageText}>
                抱歉，您没有权限访问此页面。
            </p>
        </div>

        <!-- 路径信息 -->
        <div class={classes.pathInfo}>
            <p>
                <span class={cn().weight('medium').build()}>路径：</span><code
                    class={cn().color('warning').build()}>{path}</code
                >
            </p>
        </div>

        <!-- 调试信息 -->
        {
            Object.keys(debugKVs).length > 0 && (
                <details class={classes.debugInfo}>
                    <summary class={classes.debugInfoSummary}>
                        权限信息
                    </summary>
                    <div class={classes.debugInfoContent}>
                        {Object.entries(debugKVs).map(([key, value]) => (
                            <div class={classes.debugInfoItem}>
                                <span class={classes.debugInfoKey}>
                                    {key}:
                                </span>
                                <span class={classes.debugInfoValue}>
                                    {value}
                                </span>
                            </div>
                        ))}
                    </div>
                </details>
            )
        }

        <!-- 操作按钮 -->
        <div class={classes.actions}>
            {
                loginUrl && (
                    <a href={loginUrl} class={cn().add('cosy:btn cosy:btn-primary').w('full').build()}>
                        登录账户
                    </a>
                )
            }

            <a
                href={baseUrl}
                class={cn().add('cosy:btn cosy:btn-outline cosy:no-underline').w('full').build()}>
                返回首页
            </a>

            {
                contactUrl && (
                    <a href={contactUrl} class={cn().add('cosy:btn cosy:btn-ghost').w('full').build()}>
                        联系管理员
                    </a>
                )
            }
        </div>

        <!-- 帮助提示 -->
        <div class={classes.helpText}>
            <p>如需访问权限，请联系系统管理员</p>
        </div>
    </div>
</div>
